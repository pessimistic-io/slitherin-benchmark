// SPDX-License-Identifier: MIT

// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWNK0kxooooodddxk0NWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWN0kxolc:;;;;;;;;;,''';lkKWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN0kdl::cloooddoooodddoolc;,.,dXMMMMWWMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNKOxoccllllloddol:,,:odxxdddxddl,'oOOkkkkOOOO0KXWMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMN0dlccloodddodddxxl'   'clldxxdlc::;;ldxOOO00OOkxxxkOO0NWMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNOoccoooc:ldxxdddxxdl;',;,...;lccccldoloxddodk0000OkddxkxxkKWMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMW0oclooc;'...lxxxdxdoodkxdo;..,;coxxxxkdll:....;d00x:'...:k0kdOWMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWKdcclloo;.....cddddoldkkdoccllodolodxxxxxo;......l00c......okdllOWMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWXd:::clooc::cllooollloxxoc:cloxxxc...;oxxdol;....'ck0xl;'.'';:...,lOWMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMNOc;;...:oc:;,;cdolcclool::cldol:cc'  ..lxdc;lxdlodkkdodO0Okkd:,..'lxo0MMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXxc:l:'',:ll;...colloolc:::ldo:.....,;;codl::oxkkkkdlodxkkkkxdl::::cdOddXMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXd:colcolcclccclllloooc::lodxx:. ....;cclc::oxddxxdodxOOOkdloxO0kdllodOko0MMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWk:colcllcllldolllddoc;;coxxdoo:,,'',c;...':odddolldkOOOkdoodk0Oxoooodddoo0MMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMKlcolclllloddoloddoc:'.'lddxdl:cdxxxdl'...'lxxdlodkkkxolldxdodo,....:oddclKMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMWNX0Oxdoooooodk0XWMMMMMNkccc:;;::col:llc:;;;'....:xkolldoooo::c:;cdddooxkkkdooodxxxdd:.  ....cddcdNMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMN0kdl:,.          ..;dO0kddl;,,,,',,;;,',,'....'.....:oc:looooolokxlodoodxkOkdlldkkkkxxxkc.  ...'ldooKMMMMMMMM
// MMMMMMMMMMMMMMMMMMWXxlldxO0K0o.     .',,;,''',,''',;cooodollooooc;''',,;::;,,;:::;,,;odxxdlldkkkxooodxdxkkOkxddlc:;;:codoo0WMMMMMMMM
// MMMMMMMMMMMMMMMMW0l''dXWMMMWNx. .';;::;,,,,,;;:c:coxkkkOkxxxxxxd:'';;,:loc;:odo:,',;::c:;,,coollooxxdoloxkkdooxkOOkxxxoloKWMMMMMMMMW
// MMMMMMMMMMMMMMWOc.  cXWWX0xc,.,:::c::cc:::;;;:cloxkkOOOkxkkxoddc,;:;;:c:::lxkd:;:lxxolc:;,;;,,,;cddodooollloxOOkkkxdoc:dXMMMMMMMMMMW
// MMMMMMMMMMMMMWx.  ..':c;'. .:c:;:cllccc::::;;:coxxddxxxddxdooo:',;,:l:;:ldkko;';odolcllc:;;;;,',colc:;;:cloxkOOOOkxo::xNMMMMMMMMMMMM
// MMMMMMMMMMMMMWOc;,''...    ',',cllc::::::;,,;codddddxddxddddo:',;;cc;;clolc:;,',c:,:ooc:::::;'':dolllcc:,'';dkkkkkd:l0WMMMMMMMMMMMMM
// MMMMMMMMMMWXkc'.               ..,;;::;;;;,,:loooddxddkkxxxd:.'',:;,',ll:;;:clcc:..;lc:c::c:clllllooooo,. ..;dxxdcckNMMMMMMMMMMMMMMM
// MMMMMMMMWKl'    .;cooc'           ..;::;,,,;ldxxkOO00KKKOOKk;',,'.....,;;:lodoccc::cc:ccc:cloolloodollc,...',clclxXMMMMMMMMMMMMMMMMM
// MMMMMMMXo.   .cOXWMMMMXx,           .,c:;,;cdOKKKKXXXXXXKK0c'','.'','';ccccoolllll:colllc:clododolllllddoooc''',dNWMMMMMMMMMMMMMMMMM
// MMMMMM0;   .cKWMMMMMMMMM0'           .,;;:lddk0KK00XXXXXXKd,.''';c;,,:cc:ccccclccllodol:;coollll:::,;oxolo:;:oo:;dXMMMMMMMMMMMMMMMMM
// MMMMM0;   .dNMMMMMMMMMMMX:             ':lkkxxOKKKKXXX00XKd,..',;;,;c::ccc:::loooooo:,;;;clcclcc:c;.'clc:::okOkd::kWMMMMMMMMMMMMMMMM
// MMMMNc    oWMMMMMMMMMMMM0'             .;xOkxkO0KKXXXXKKXOdc',,';::::::::::colldoooc,..':llcclloddoc:;;codxkOOxxd:c0WMMMMMMMMMMMMMMM
// MMMMk.   .OMMMMMMMMMMMW0;               'odoook00KXXXXXXXOo:;c:;:,',;,',;cclolcol;;::;;;::'..:dxdc:cookK0OOkkkOOxl;dNMMMMMMMMMMMMMMM
// MMMWd    .lNMMMMMMMMWKo.                .cdoook0KKXXXXXX0xl;;::lolc:,'';clcclc:clccc:;;::;;;:::llldKXXKXK0K0xdkOkdcoXMMMMMMMMMMMMMMM
// MMMWo      ,oOKNNX0x:.                  .lxkxdOKKK0000XXKxc,,:ldxxxdllc:c:,;cccc:::::::cooldxdx0K0KXXXXXXXXX0kxxkxcl0WMMMMMMMMMMMMMM
// MMMMx.        .....                     ,xOkdx00OOOkxxOOOo,,;:ldddxddxdl:,,;;:lc:c:'..,lddk0XXXXXXXK00000KK000xddo::OWMMMMMMMMMMMMMM
// MMMMK;                                 .cOkxddxkOOOxdllcol;:lccoodxxxxdxdlc:;:c:;;;,,;ckOOKKKXXX0OOOxkOkxkkddkOxooccOWMMMMMMMMMMMMMM
// MMMMWk.                   .:xxc.       ,x0OOkxkO00Oxddool::clcldddxdddoxxddl:::cc:cdoclk0xxxxO0OxkO000K0000OkOkkdlccOWMMMMMMMMMMMMMM
// MMMMMWx.                 .xWMMWk.     .lO0OO0OOOOOOkxkkxxoccodxxxkOkxdodxodxxxxdddxkoldxddkkxkxdk0000KK00KKKKKOkdcclOWMMMMMMMMMMMMMM
// MMMMMMWO,                .xNMMNx.    .;d00OOOOxxOkkkxkOxxxlloxkkO00OOkddddxxxkkxdxxxdxOkdxO000OkO00Ok0KOkKK000Oko::o0WMMMMMMMMMMMMMM
// MMMMMMMMXd'               .,::,.   .;oloO0kOOOOOOOOOOOOkkxldxxOOO0OkxxddddxxkkxxxxdddxOkxk00000000KOO0KKKK0kO0kxo:lONMMMMMMMMMMMMMMM
// MMMMMMMMMMXx:.                   .;lodooOK000000000000000kodddkOO0KOkkddxxkxxkxxxxdolldkOOOkk0OOO000KKKKKKK0000d::kNMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMWKkl;'.          ...;lodoc:ckKKKKKK0KKKOk0K00kdxOkkOO00OOkddkxkxkxolccc:;,;lxkOxk0kxk0Ok0KKK0KK0kOOl;oXMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMWNKOo;'..'',;:;;coldl;,;oO00K0OOKKKK0KKOkxoxOxdddxkkkkddxxkkxxl,'''',;;coxOOO0Oxk0OO0KKOk00Oxxo;lKWMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMWO:.,:c::c:;:;;cc;;;cxkOKK00KKKKKK0kdoccloxxoodooddoddxxddl;',,,;::ldkOOOOOOO00000KK0000klcdKWMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMNd'.,::;::cc:::c:::cokOKKK00KKKK00Oxo:'',lxoloodxdodooocc:::::;:clodxkkO0K0KKK0kOKXK000ocdKMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMXo,';:;:cclllllccc:ldkO00OO0000OOkdxo;,'':lloolddl::cclolllll:::cddxOOdd0XKKXX0OKXKOxl;dXMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMKo:,,;;cclllolc::;:ldk00OkOKKOkOOodxlc;;:llclloocllododoccloc:c:lllol:;xX0OKXKKKKKOc;oKWMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMNkc;,;::::;,,;;;,':oxkkkk0XKOkkkdkkc:::cooloooolodxxdooloooc:c::::ll:;kXXXKKXXKkdc;l0WMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMWKxl:;:c;',lool:'.;oxkO0OKX00kxOK0l;:::cc::;;;;cxxxoclooool;,;:ccll:,o0XXK0KX0l':kXWMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMWKl'',.':lllc'.':dk0XXKKXXK0O0K0d:c:,;:::c:'';dkxdllllddl:'.;cccl:,ckKXK0kxl''xWMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMKd:',clll;.';:;cx0XXXXXXXXXXX0kol;'coooo;',:dkdolloloolc;'',:lc:';kKX0dc,.',kMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMO;':cl:,.,::::;:ok0KXK0KXXXXX0dc,,loooc'':cdkxddoddlllc:;,'':lc,,ok0d,..,;;kMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMM0:,clc:,',;c;;::;,:okKKKXXXX00Od:',llol,.;ccclolooodoool:::c;';l;.:c;;ll;:c;dWMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMKc,cc:oOK0Okdl,.,;,',cxO0K00XXK0Ol',lll;.,ccc::llldoodlcllcccc,.,,..;oONWKl;,cXMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMNo';:cxNMMMMWNO;......,:oxOO00KK00d''c:;'':llcc::cccllll::c:;;,'''...cXMMMMXl.'kWMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMWk;,;lKMMMMMMMMk,,;'.,ll::clddxxdkOo'':,.';:ll::c;:c;:c:,,;;,:oookOo'.:XMMMMM0;.oWMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMK:';xNMMMMMMMMWd,:;'lKWX0Okxddocclo:.';'.';,::.....',:::lokOOKNWMMMWk';KMMMMMW0okWMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMNl.:0WMMMMMMMMMNl'',xNMMMMMMWNNXXK00x,.,cdk0O00kc.'';OXKXNWWMMMMMMMMMWOkNMMMMMMMWWMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMWx,lXMMMMMMMMMMMK;.,kWMMMMMMMMMMMMMMMXc.;0WMMMMMMXo',dWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMWOkNMMMMMMMMMMMM0,,OWMMMMMMMMMMMMMMMMWx'cXMMMMMMMMXl'xWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMXxOWMMMMMMMMMMMMMMMMMMNxkWMMMMMMMMMXdkWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMWWMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
// MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM

// The team is ready and the 17 rockets are about to blast off, embarking with them 777 passengers. 
// After months of decrypting the mystery of the 1875 Telescope and following the path of 
// a victorian astronomer, we are ready to join the Launch Pad - Are you ready?

// This Train Ticket is your first step into the Mignonverse

// Arist: Lapin Mignon - https://twitter.com/Lelapinmignon

// Coder: Tagachi - https://twitter.com/TagachiStudio


pragma solidity ^0.8.4;

import "./ERC721.sol";
import "./Ownable.sol";

contract MignonTrainTickets is ERC721, Ownable {

    uint256 public totalSupply;
    uint256 public totalClaimed;
    uint256 public claimSupply;
    uint256 public maxSupply;

    bool public claimingPaused;
    bool public mintingPaused;

    string internal baseTokenUri;
    string public hiddenMetadataUri;
    bool public isEmbarked;

    uint256 public mintCost;
    address public withdrawWallet;

    uint256 public maxClaimsPerWallet;

    mapping(address => uint256) public WalletMints;
    mapping(address => uint256) public AllowList;
    mapping(address => uint256) public DevList;

    constructor() payable ERC721('Mignon Train Tickets', 'MTT') {
        totalSupply = 0;
        totalClaimed = 0;
        claimSupply = 777;
        maxSupply = 7675;

        mintingPaused = true;
        claimingPaused = true;

        setHiddenMetadataUri("https://orion.mypinata.cloud/ipfs/QmXc1QEbEeAE998e8CjuEtmZNWWftwS1yoVbgLHy9neGhQ");
        isEmbarked = false;

        mintCost = 0.017 ether;
        withdrawWallet = 0xEF247Fb4A0bb76398472af7729d9819bB446e4BB;

        maxClaimsPerWallet = 1;

    }

    modifier callerIsAWallet() {
        require(tx.origin ==msg.sender, "Another contract detected");
        _;
    }

    // Futureproofing Minting Cost
    function changeMintCost(uint256 mintCost_) public onlyOwner() {
        mintCost = mintCost_;
    }

    // Increase Claim Supply
    function addMoreToClaimSupply(uint256 quantity_) public onlyOwner() {
        claimSupply = claimSupply + quantity_;
    }

    //Change Wallets - Failsafe
    function changeWithdrawWallet(address withdrawWallet_) external onlyOwner {
        withdrawWallet = withdrawWallet_;
    }

    //Add Addresses for Allowlist Mint
    function addToAllowList(address[] calldata addresses, uint8 numAllowedToMint) external onlyOwner {
        for (uint256 i = 0; i < addresses.length; i++) {
            AllowList[addresses[i]] = numAllowedToMint;
        }
    }     

    //Add Addresses for Dev Mint
    function addToDevList(address[] memory addresses, uint256[] memory numOfSlots) external onlyOwner {
        for (uint256 i = 0; i < addresses.length; i++) {
            DevList[addresses[i]] = numOfSlots[i];
        }
    }

    //Update Hidden Metadata URI
    function setHiddenMetadataUri(string memory hiddenMetadataUri_) public onlyOwner {
        hiddenMetadataUri = hiddenMetadataUri_;
    }

    //Token URI change - More utility is coming!
    function setBaseTokenUri(string calldata baseTokenUri_) external onlyOwner {
        baseTokenUri = baseTokenUri_;
    }

    function tokenURI(uint256 tokenId_) public view override returns (string memory) {

        if (isEmbarked == false) {
            return hiddenMetadataUri;
            }

        require(_exists(tokenId_), 'Token does not exist!');
        return string(abi.encodePacked(baseTokenUri, Strings.toString(tokenId_), ".json"));
    }

    string private customContractURI = "https://orion.mypinata.cloud/ipfs/QmXc1QEbEeAE998e8CjuEtmZNWWftwS1yoVbgLHy9neGhQ";

    function setContractURI(string memory customContractURI_) external onlyOwner {
        customContractURI = customContractURI_;
    }

    function contractURI() public view returns (string memory) {
        return customContractURI;
    }    

    //NFT London Free Claim
    function claim() public callerIsAWallet {
        uint256 quantity = maxClaimsPerWallet;
        uint256 newTokenId = totalSupply + quantity;

        require(!claimingPaused, 'claiming is paused');
        require(totalClaimed + quantity <= claimSupply, 'no more to claim!');
        require(WalletMints[msg.sender] < quantity, 'exceed max wallet');
        
        WalletMints[msg.sender]++;
        totalSupply++;

        _safeMint(msg.sender,newTokenId);
    }

    //Train Ticket Mint
    function mint(uint256 quantity_) public payable callerIsAWallet {

        require(!mintingPaused, 'minting is paused');
        require(msg.value >= quantity_ * mintCost, 'wrong mint value');
        require(totalSupply + quantity_ <= maxSupply, 'sold out');
        
        for(uint256 i = 0; i < quantity_; i++) {
            uint256 newTokenId = totalSupply + 1;

            WalletMints[msg.sender]++;
            totalSupply++;
            
            _safeMint(msg.sender, newTokenId);
        }
    }

    //Mignon Dao Mint

    function DevListMint(uint256 quantity_) public callerIsAWallet {

        require(totalSupply + quantity_ <= maxSupply, 'sold out');
        require(DevList[msg.sender] > 0, "not eligible for DevList mint");

        for(uint256 i = 0; i < quantity_; i++) {
            uint256 newTokenId = totalSupply + 1;

            WalletMints[msg.sender]++;
            DevList[msg.sender]--;
            totalSupply++;
            
            _safeMint(msg.sender, newTokenId);
        }
    }

    function pauseClaiming() public onlyOwner {
        claimingPaused = !claimingPaused;
    }

    function pauseMinting() public onlyOwner {
        mintingPaused = !mintingPaused;
    }

    function embarkTrain() public onlyOwner {
        isEmbarked = true;
    }


    function withdraw() external onlyOwner {
        (bool success, ) = withdrawWallet.call{ value: address(this).balance }('');
        require(success, 'withdraw failed');
    }
 
}
